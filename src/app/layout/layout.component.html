<div class="layout">
	<aside class="sidebar">
		<div class="sidebar__profile">
			<div class="sidebar__avatar">
				<img [src]="user.avatar" [alt]="user.name" />
			</div>
			<h1 class="sidebar__name">{{ user.name }}</h1>
		</div>

		<nav class="sidebar__nav">
			<button
				type="button"
				class="sidebar__item"
				*ngFor="let item of navigation"
				[class.sidebar__item--active]="item.active"
				[class.sidebar__item--danger]="item.variant === 'danger'"
				(click)="onNavClick(item)"
			>
				<span class="sidebar__icon material-symbols-rounded">{{ item.icon }}</span>
				<span class="sidebar__label">{{ item.label }}</span>
			</button>
		</nav>
	</aside>

	<main class="main">
		<div class="main__card" *ngIf="currentView === 'sections'">
			<div class="main__header">
				<div class="main__avatar">
					<img [src]="user.avatar" [alt]="user.name" />
				</div>
				<div class="main__profile">
					<h2>{{ user.name }}</h2>
					<div class="main__category-tag" *ngIf="activeCategory as selectedCategory">
						<span class="material-symbols-rounded">label</span>
						{{ selectedCategory.name }}
					</div>
				</div>
			</div>

			<div class="main__sections">
				<app-section-card
					*ngFor="let section of sections"
					[label]="section.label"
					[icon]="section.icon"
					[active]="!!section.active"
					(select)="onSectionSelect(section)"
				></app-section-card>
			</div>
		</div>

		<div class="main__card main__card--practice" *ngIf="currentView === 'practice'">
			<button type="button" class="btn btn--ghost practice__back" (click)="exitPracticeSession()">
				<span class="material-symbols-rounded">arrow_back</span>
				Devolver
			</button>
			<div class="practice__content">
				<div class="practice" *ngIf="practiceWords.length && !practiceFinished; else practiceEmpty">
					<div class="practice__panel">
					<div class="practice__card" [class.practice__card--revealed]="practiceRevealed" (click)="togglePracticeReveal()">
						<ng-container *ngIf="!practiceRevealed; else practiceReveal">
							<ng-container *ngIf="practiceCurrentWord?.imageUrl; else practicePlaceholder">
								<img [src]="practiceCurrentWord?.imageUrl" [alt]="practiceCurrentWord?.title" />
							</ng-container>
							<ng-template #practicePlaceholder>
								<div class="practice__placeholder material-symbols-rounded">image</div>
							</ng-template>
						</ng-container>
						<ng-template #practiceReveal>
							<h3>{{ practiceCurrentWord?.title || '—' }}</h3>
							<p>{{ practiceCurrentWord?.meaning || 'Sin significado registrado.' }}</p>
						</ng-template>
						<div class="practice__progress">{{ practiceIndex + 1 }}/{{ practiceWords.length }}</div>
					</div>
					<div class="practice__actions">
						<button type="button" class="practice__btn practice__btn--skip" (click)="handlePracticeDislike()">
							<span class="material-symbols-rounded">thumb_down</span>
							No la recordé
						</button>
						<button type="button" class="practice__btn practice__btn--like" (click)="handlePracticeLike()">
							<span class="material-symbols-rounded">thumb_up</span>
							¡Aprendida!
						</button>
					</div>
				</div>
				</div>
				<aside class="practice__stats">
				<div class="practice__stat-block">
					<h4>Avance</h4>
					<div class="practice__counter">
						<span>{{ practiceProgressCount }}/{{ practiceWords.length || practiceSessionSize }}</span>
						<small>Sesión de {{ practiceWords.length || practiceSessionSize }}</small>
					</div>
				</div>
				<div class="practice__stat-block">
					<h4>Palabras nuevas</h4>
					<div class="practice__counter practice__counter--secondary">
						<span>{{ practiceLearned }}</span>
						<small>Aprendidas</small>
					</div>
					<p class="practice__note" *ngIf="practiceForgotten">{{ practiceForgotten }} por repasar</p>
				</div>
					<button type="button" class="btn btn--ghost practice__restart" *ngIf="practiceFinished" (click)="restartPractice()">Reiniciar sesión</button>
				</aside>
			</div>
		</div>

		<ng-template #practiceEmpty>
			<div class="practice__empty">
				<h3 *ngIf="practiceFinished && practiceWords.length">¡Sesión completada!</h3>
				<h3 *ngIf="!practiceWords.length">No hay palabras suficientes</h3>
				<p *ngIf="practiceFinished && practiceWords.length">Puedes reiniciar para repasar nuevamente.</p>
				<p *ngIf="!practiceWords.length">Agrega nuevas palabras para practicar.</p>
				<div class="practice__empty-actions">
					<button type="button" class="btn btn--ghost" (click)="restartPractice()" *ngIf="practiceWords.length">Reiniciar</button>
					<button type="button" class="btn btn--primary" (click)="openAddWord()" *ngIf="!practiceWords.length">Agregar palabra</button>
				</div>
			</div>
		</ng-template>

		<div class="main__card main__card--categories" *ngIf="currentView === 'categories'">
			<div class="main__categories">
				<app-section-card
					*ngFor="let cat of categories"
					[label]="cat.name"
					[icon]="cat.icon"
					[active]="!!cat.active"
					(select)="onCategoryClick(cat)"
				></app-section-card>
			</div>
		</div>

		<div class="main__card main__card--search" *ngIf="currentView === 'search'">
			<div class="search-bar">
				<div class="search-bar__menu material-symbols-rounded" title="Menú">menu</div>
				<input class="search-bar__input" placeholder="Hinted search text" />
				<div class="search-bar__icon material-symbols-rounded" title="Buscar">search</div>
			</div>
			<div class="search-category-chip" *ngIf="activeCategory as chipCategory">
				<span class="material-symbols-rounded">label</span>
				{{ chipCategory.name }}
				<button type="button" (click)="clearCategoryFilter()">×</button>
			</div>
			<div
				class="search-filter-chip"
				*ngIf="searchMode === 'favorites'"
			>
				<span class="material-symbols-rounded">star</span>
				Favoritas
				<button type="button" (click)="clearSearchMode()">×</button>
			</div>
			<div
				class="search-filter-chip"
				*ngIf="searchMode === 'review'"
			>
				<span class="material-symbols-rounded">history</span>
				Por repasar
				<button type="button" (click)="clearSearchMode()">×</button>
			</div>
			<ng-container *ngIf="filteredWords.length; else emptySearch">
				<div class="words-grid">
					<app-word-card
						*ngIf="searchMode !== 'review'"
						[word]="{ title: 'Agregar', addCard: true }"
						(add)="openAddWord()"
					></app-word-card>
					<app-word-card
						*ngFor="let w of filteredWords"
						[word]="w"
						(delete)="requestDeleteWord($event)"
						(edit)="openEditWord($event)"
						(favoriteToggle)="toggleFavorite($event)"
					></app-word-card>
				</div>
			</ng-container>
			<ng-template #emptySearch>
				<div class="search-empty" [class.search-empty--review]="searchMode === 'review'">
					<p *ngIf="searchMode === 'favorites'">Aún no tienes palabras marcadas como favoritas.</p>
					<p *ngIf="searchMode === 'review'">Cuando marques palabras como "No la recordé" en practicar aparecerán aquí para repasar.</p>
					<p *ngIf="searchMode === 'all'">Agrega nuevas palabras para comenzar tu biblioteca.</p>
					<button type="button" class="btn btn--primary" (click)="openAddWord()" *ngIf="searchMode !== 'review'">Agregar palabra</button>
				</div>
			</ng-template>
		</div>

		<!-- Overlay confirm delete word -->
		<div class="delete-word-overlay" *ngIf="wordToDelete as pendingDelete">
			<div class="delete-word-overlay__panel">
				<p class="delete-word-overlay__text">¿Está seguro que desea eliminar la palabra?</p>
				<div class="delete-word-overlay__word-info">
					<span class="material-symbols-rounded" *ngIf="!pendingDelete.imageUrl">image</span>
					<img *ngIf="pendingDelete.imageUrl" [src]="pendingDelete.imageUrl" [alt]="pendingDelete.title" />
					<div class="delete-word-overlay__meta">
						<strong>{{ pendingDelete.title }}</strong>
						<small *ngIf="pendingDelete.meaning">{{ pendingDelete.meaning }}</small>
					</div>
				</div>
				<div class="delete-word-overlay__actions">
					<button type="button" class="btn btn--ghost" (click)="cancelDeleteWord()">Cancelar</button>
					<button type="button" class="btn btn--danger" (click)="confirmDeleteWord()">Eliminar</button>
				</div>
			</div>
		</div>

		<div class="main__card main__card--logout" *ngIf="currentView === 'logout'">
			<div class="logout-confirm">
				<p>¿Está seguro que desea salir de la sesión?</p>
				<div class="logout-confirm__actions">
					<button type="button" class="btn btn--ghost" (click)="cancelLogout()">Cancelar</button>
					<button type="button" class="btn btn--primary" (click)="confirmLogout()">Salir</button>
				</div>
			</div>
		</div>

		<div class="main__card main__card--delete-account" *ngIf="currentView === 'deleteAccount'">
			<div class="delete-confirm">
				<p>¿Está seguro que desea eliminar la cuenta?</p>
				<div class="delete-confirm__actions">
					<button type="button" class="btn btn--ghost" (click)="cancelDeleteAccount()">Cancelar</button>
					<button type="button" class="btn btn--danger" (click)="confirmDeleteAccount()">Eliminar</button>
				</div>
			</div>
		</div>

		<app-add-word-modal
			*ngIf="showAddModal"
			[word]="editingWord"
			[categories]="categories"
			[defaultCategoryId]="activeCategory?.id || categories[0]?.id"
			(save)="saveNewWord($event)"
			(cancel)="cancelAddWord()"
		></app-add-word-modal>
	</main>
</div>

